<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-2 mb-8">
  <nav class="flex space-x-1" id="shipping-nav-tabs">
    <% 
      is_overview = controller_name == 'shipping_options' && action_name == 'index'
      is_shipping_methods = controller_name == 'shipping_options' && action_name == 'shipping_methods'
      is_rate_tables = controller_name == 'rates' && action_name == 'index' && !params[:shipping_option_id]
    %>
    
    <%= link_to shipping_options_path, 
        class: "nav-tab flex items-center px-6 py-3 text-sm font-medium rounded-xl #{'bg-blue-50 text-blue-700 border border-blue-200' if is_overview} #{'text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-colors duration-200' unless is_overview}",
        data: { turbo_frame: "shipping_content", tab: "overview" } do %>
      <i class="fa-solid fa-grid-3 mr-2"></i>
      Overview
    <% end %>
    
    <%= link_to shipping_methods_shipping_options_path, 
        class: "nav-tab flex items-center px-6 py-3 text-sm font-medium rounded-xl #{'bg-blue-50 text-blue-700 border border-blue-200' if is_shipping_methods} #{'text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-colors duration-200' unless is_shipping_methods}",
        data: { turbo_frame: "shipping_content", tab: "shipping_methods" } do %>
      <i class="fa-solid fa-list mr-2"></i>
      Shipping Methods
    <% end %>
    
    <%= link_to rate_tables_path, 
        class: "nav-tab flex items-center px-6 py-3 text-sm font-medium rounded-xl #{'bg-blue-50 text-blue-700 border border-blue-200' if is_rate_tables} #{'text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-colors duration-200' unless is_rate_tables}",
        data: { turbo_frame: "shipping_content", tab: "rate_tables" } do %>
      <i class="fa-solid fa-arrows-up-down mr-2"></i>
      Rate Tables
    <% end %>
  </nav>
</div>

<script>
// Handle tab navigation and active states
document.addEventListener('DOMContentLoaded', function() {
  // Function to update active tab
  function updateActiveTab(activeTab) {
    console.log('Updating active tab to:', activeTab);

    // Remove active class from all tabs
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.classList.remove('bg-blue-50', 'text-blue-700', 'border', 'border-blue-200');
      tab.classList.add('text-gray-600', 'hover:text-gray-900', 'hover:bg-gray-50');
    });
    
    // Add active class to the clicked tab
    const activeTabElement = document.querySelector(`[data-tab="${activeTab}"]`);
    if (activeTabElement) {
      activeTabElement.classList.remove('text-gray-600', 'hover:text-gray-900', 'hover:bg-gray-50');
      activeTabElement.classList.add('bg-blue-50', 'text-blue-700', 'border', 'border-blue-200');
      console.log('Tab updated successfully:', activeTab);
    } else {
      console.log('Tab element not found:', activeTab);
    }
  }
  
  // Store the currently active tab
  let currentActiveTab = 'overview'; // Default to overview

  // Add click listeners to tabs
  document.querySelectorAll('.nav-tab').forEach(tab => {
    tab.addEventListener('click', function(e) {
      const tabName = this.getAttribute('data-tab');
      console.log('Tab clicked:', tabName);
      currentActiveTab = tabName; // Store the clicked tab
      updateActiveTab(tabName);
    });
  });
  
  // Listen for turbo frame loads to update active state
  document.addEventListener('turbo:frame-load', function(e) {
    console.log('Turbo frame loaded:', e.target.id);
    if (e.target.id === 'shipping_content') {
      // Use the stored active tab instead of trying to detect from URL
      console.log('Using stored active tab:', currentActiveTab);
      updateActiveTab(currentActiveTab);
    }
  });

  // Also listen for turbo:load events
  document.addEventListener('turbo:load', function() {
    console.log('Turbo load event');
    // Use the stored active tab
    console.log('Using stored active tab on load:', currentActiveTab);
    updateActiveTab(currentActiveTab);
  });
});
</script>
